class m{static name="campaign_linebar";constructor(a,e){this.promise=null,this.data={baselinePercentage:0,rank:-1,compareStart:0,compareEnd:0}}async onAdd(a,e){}async onRemove(a,e){}async updateData(a,e,t){t.compareEnd&&t.compareStart&&(this.data.compareEnd=t.compareEnd,this.data.compareStart=t.compareStart),t.rank!==void 0&&(this.data.rank=t.rank)}getMeterPoint(a,e){let t="accumulated_real_baseline_point";const r=e.getters.charts[0].meterGroupPath;return a.getters[r+"/meters"][0].classInt===9990002&&(t="periodic_real_baseline_point"),t}getColors(a,e,t){const l=[];this.data.baselinePercentage=0;const r=[214,35,38],s=[25,162,58],n=[r[0]-s[0],s[1]-r[1],s[2]-r[2]],d=7.5;for(let h in a){let i=0;try{i=a[h].y/e[h].y*100-100}catch(p){console.error("Error calculating percentage difference:",p);continue}this.data.baselinePercentage+=i;const c=Math.min(Math.abs(i)/d,1);let o=[0,0,0];i<-d?o=s:i>d?o=r:i<0?o=[Math.round(n[0]-r[0]*c),Math.round(n[1]+r[1]*c),Math.round(n[2]+r[2]*c)]:o=[Math.round(n[0]+s[0]*c),Math.round(n[1]-s[1]*c),Math.round(n[2]-s[2]*c)],l.push(`rgb(${o[0]}, ${o[1]}, ${o[2]})`)}return this.data.baselinePercentage/=a.length,l}async preData(a,e){if(e.getters.charts.length>1)throw new Error("This block modifier expects only one chart");this.data.dlData={};const t={point:this.getMeterPoint(a,e),dateStart:e.getters.dateStart/1e3,dateEnd:e.getters.dateEnd/1e3,intervalUnit:e.getters.intervalUnit,dateInterval:e.getters.dateInterval,graphType:e.getters.graphType,compareStart:this.data.compareStart/1e3,compareEnd:this.data.compareEnd/1e3};this.promise=a.dispatch(e.getters.charts[0].path+"/getData",t)}async postData(a,e,t){if(!t)return;const l=(await this.promise).data;t.datasets.splice(0,0,{label:"Baseline",backgroundColor:"#FFF",borderColor:"#FFF",fill:!1,showLine:!0,spanGaps:!1,data:l,type:"line"}),t.datasets[1].label="Current Use",t.datasets[1].spanGaps=!0;let r=t.datasets[1].data,s=t.datasets[0].data;(s.length===0||r.length===0)&&(r=[],s=[]);const n=this.getColors(r,s);t.datasets[1].borderColor=n[0],t.datasets[1].backgroundColor=n}}export{m as default};
